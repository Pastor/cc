##### Общее
- Пользователь находится в доверенной среде и манипулирует нешифрованными данными. Знает только логин и пароль.
- Каналы передачи данных менее доверенные поэтому перекрываются `SSL`
- Сервис находится во враждебной среде. Не хранит пароли, хэши паролей. Хранит все данные исключительно
  в зашифрованном виде. Приватный ключ авторизованного пользователя висит в памяти все время сессии. Симметричный ключ
  в открытом виде живет только в памяти и только на время шифрования, дешифрования файла либо передачи файла другому 
  пользователю.
- Пользователь закачивает и скачивает файл в открытом виде потоком(блоками данных в одном соединении)

##### Основное
1. Ключ симметричного шифрования для файла должен находится только в памяти
2. файл шифруется на лету симметричным ключом, далее ключ шифруется публичным ключом хозяина и сохраняется
3. Работа с сервисом происходит только по `SSL`(открытый, закрытый ключ сервиса для соединения)
4. При всех авторизованных вызовах передается сессионный ключ - токен
5. По токену невозможно получить от сервиса симметричный ключ либо приватный ключ.

##### 
- [ ] Информация о файле
    - [ ] Имя файла 
    - [ ] Размер в байтах 
    - [ ] Хэш `SHA256` его реального тела(приходит с мета данными, нужен для проверки корректности пришедших данных, 
          потом удаляется) 
    - [ ] Информация о ключе (алгоритм, размер)
    - [ ] Информация о шифровании (алгоритм, трансформация)
    - [ ] Информация о ЭЦП(алгоритм хэш, алгоритм подписи)
    - [ ] ЭЦП(опционально)
    - [ ] Шифрованый открытым ключом хозяина симметричный ключ
    - [ ] Путь до шифрованного содержимого(`SHA256` от шифрованного тела)
    - [ ] Смещение(на котором была прервана закачка, для дальнейшей закачки)
    - [ ] Идентификатор создателя файла
    - [ ] Время создания
- [ ] Регистрация
    - [ ] Логин и пароль(генерируется ключевая пара, закрытый ключ шифруется паролем). Пользователю отдается, 
          идентификатор, публичный ключ (ключ сформирован на основе сертификата сервиса, по запросу)
    - [ ] По `URL`с идентификатором пользователя можно получить сертификат (`/rest/api/v1/users/1/certificate`, 
          `/rest/api/v1/me/certificate`)
    - [ ] По `URL`с идентификатором можно получить информацию по пользователю (если вы находитесь в одном с 
          ним окружении) - мыло, логин и т.д. (уточнить) (`/rest/api/v1/users/1`, `rest/api/v1/me` - профиль)
- [ ] Авторизация 
    - [ ] `BasicAuthentication` передается логин и пароль. 
          По паролю расшифровывается приватный ключ пользователя и помещается в памяти (временная таблица).
          Формируется сессионый ключ (токен с временем жизни, `UUID`) и возвращается пользователю.
    - [ ] `TokenAuthentication` передается токен выданный на этапе авторизации. При попытке доступа 
          к сервису с сессионным ключем которого не существует - ошибка `401`
- [ ] Сервис работы с сессионными ключами
    - [ ] Периодически просматриваются сессионные ключи и если у них вышло время - они удаляются. 
          Удаляется приватный ключ пользователя из памяти.
    - [ ] Возможно продление сессионного ключа пользователем (вызов продления). Максимальное
          значение 24 часа. (если сервис перезапускался, время продления не действительно)
- [ ] Загрузка файла
    - [ ] Передается информация о файле (имя, размер, хэш, ЭЦП, имя виртуальной папки). Возвращается идентификатор файла, 
          `URL` загрузки. Код 202 в случе успеха, 401-403-402-405-411-429-413
    - [ ] По переданному `URL` передать содержимое файла. 
          406 - данные не совпадают по переданному хэшу, 
          413 - передаваемые данные больше указанных при создании информации о файлах,
          201 - файл создан,
          403 - ,
          405 - ,
          411 - ,
          410 - ;
    - [ ] При обрыве соединения, можно запросить смещение на котором остановились и докачать (как хранить 
          значения для расчета хэш?)
- [ ] Получение файла
    - [ ] Получение списка файлов с метаинформацией (имя, размер, виртуальная папка, хэш) 
    - [ ] По сформированному `URL` получить метаданные по файлу ("Информация по файлу" + `URL` по которому можно 
          получить содержимое) 
    - [ ] По переданному `URL` получаем данные файла. По токену получаем закрытый ключ. При помощи закрытого ключа
          расшифровываем симметричный ключ. При помощи симметричного ключа расшифровываем содержимое и передаем потоком.
- [ ] Передача прав на файл
    - [ ] Выбирается свой файл (идентификатор), выбирается пользователь из своего окружения (иденификатор) и передается 
          сервису. Сервис по идентификатору находит файл, по приватному ключу пользователя осуществившего запрос
          расшифровывает симметричный ключ, далее по сертификату пользователя зашифровывает симметричный ключ и передает
          его в виде метаинформации пользователю назначения. Симметричный ключ выгружается из памяти.
    - [ ] Отдельная таблица прав на файлы (идентификатор файла, шифрованный симметричный ключ, идентификатор пользователя
          к с которым связан этот файл, идентификатор виртуальной папки). По идетификатору файла можно получить владельца 
          и узнать собственный ли это файл или переданный файл. Виртуальная папка - при передачи прав стандартная 
          "Переданные".
#### Используемые коды
- `100` Continue ("продолжай")
- `102` Processing ("идёт обработка")
- `200` OK ("хорошо")
- `201` Created ("создано")
- `202` Accepted ("принято")
- `204` No Content ("нет содержимого")
- `206` Partial Content ("частичное содержимое")
- `400` Bad Request ("плохой, неверный запрос")
- `401` Unauthorized ("не авторизован")
- `402` Payment Required ("необходима оплата")
- `403` Forbidden ("запрещено")
- `404` Not Found ("не найдено")
- `405` Method Not Allowed ("метод не поддерживается")
- `406` Not Acceptable ("неприемлемо")[
- `408` Request Timeout ("истекло время ожидания")
- `409` Conflict ("конфликт")
- `410` Gone ("удалён")
- `411` Length Required ("необходима длина")
- `412` Precondition Failed ("условие ложно")
- `413` Request Entity Too Large ("размер запроса слишком велик")
- `414` Request-URI Too Large ("запрашиваемый URI слишком длинный")
- `415` Unsupported Media Type ("неподдерживаемый тип данных")
- `416` Requested Range Not Satisfiable ("запрашиваемый диапазон не достижим")
- `422` Unprocessable Entity ("необрабатываемый экземпляр").
- `423` Locked ("заблокировано").
- `424` Failed Dependency ("невыполненная зависимость").
- `425` Unordered Collection ("неупорядоченный набор")
- `426` Upgrade Required ("необходимо обновление").
- `428` Precondition Required ("необходимо предусловие")
- `429` Too Many Requests ("слишком много запросов")
- `431` Request Header Fields Too Large ("поля заголовка запроса слишком большие")
- `449` Retry With ("повторить с")
